/*! 
 Build based on gin-vue-admin 
 Time : 1680873134000 */
import{r as a,o as e,c as t,e as l,d as r,w as o,h as i,a0 as u,f as d,bm as s,j as n,E as p,b as m}from"./index.e22ca15e.js";import{E as c}from"./drawer.1c27929d.js";import"./overlay.b9869d98.js";/* empty css                 */import{E as y}from"./dialog.844a69bd.js";import{E as h,a as v}from"./form-item.8c20599d.js";/* empty css              */import{E as f}from"./radio.7cc63e72.js";/* empty css               */import"./tag.46cc5c34.js";import"./checkbox.bea932b2.js";import"./scrollbar.efc86474.js";import{E as b,a as I}from"./table-column.a83e6cf2.js";/* empty css                *//* empty css               */import{g,d as j,c as w,u as _,a as k}from"./authority.ead5f77e.js";import C from"./menus.b3119830.js";import N from"./apis.91e6e319.js";import V from"./datas.321ddbfc.js";import{W as x}from"./warningBar.d352a93c.js";import{E,a as A}from"./index.fc05916f.js";import"./refs.e55ffb18.js";import"./_Uint8Array.ef0d212b.js";import"./_initCloneObject.671954bf.js";import"./rand.833b8507.js";import"./strings.36175d48.js";import"./isEqual.c0ca3f92.js";import"./arrays.378bf91a.js";import"./index.21b03b03.js";import"./index.e347d1a7.js";import"./tree.6ec631af.js";import"./index.f2d9f351.js";import"./authorityBtn.6762adf2.js";import"./_plugin-vue_export-helper.cdc0426e.js";import"./api.ab90f01e.js";/* empty css             *//* empty css                                                                   */const U={class:"authority"},B={class:"gva-table-box"},q={class:"gva-btn-list"},S={class:"dialog-footer"},z={name:"Authority"},D=Object.assign(z,{setup(z){const D=a([{authorityId:0,authorityName:"根角色"}]),R=a(!1),F=a("add"),O=a({}),T=a("新增角色"),P=a(!1),W=a(!1),$=a({}),G=a({authorityId:0,authorityName:"",parentId:0}),H=a({authorityId:[{required:!0,message:"请输入角色ID",trigger:"blur"},{validator:(a,e,t)=>/^[0-9]*[1-9][0-9]*$/.test(e)?t():t(new Error("请输入正整数")),trigger:"blur",message:"必须为正整数"}],authorityName:[{required:!0,message:"请输入角色名",trigger:"blur"}],parentId:[{required:!0,message:"请选择父角色",trigger:"blur"}]}),J=a(1),K=a(0),L=a(999),M=a([]),Q=a({}),X=async()=>{const a=await g({page:J.value,pageSize:L.value,...Q.value});0===a.code&&(M.value=a.data.list,K.value=a.data.total,J.value=a.data.page,L.value=a.data.pageSize)};X();const Y=(a,e)=>{O.value[a]=e},Z=a(null),aa=a(null),ea=a(null),ta=(a,e)=>{const t=[Z,aa,ea];e&&t[e].value.needConfirm&&(t[e].value.enterAndNext(),t[e].value.needConfirm=!1)},la=a(null),ra=()=>{la.value&&la.value.resetFields(),G.value={authorityId:0,authorityName:"",parentId:0}},oa=()=>{ra(),P.value=!1,W.value=!1},ia=()=>{if(G.value.authorityId=Number(G.value.authorityId),0===G.value.authorityId)return n({type:"error",message:"角色id不能为0"}),!1;la.value.validate((async a=>{if(a){switch(F.value){case"add":0===(await k(G.value)).code&&(n({type:"success",message:"添加成功!"}),X(),oa());break;case"edit":0===(await _(G.value)).code&&(n({type:"success",message:"添加成功!"}),X(),oa());break;case"copy":{const a={authority:{authorityId:0,authorityName:"",datauthorityId:[],parentId:0},oldAuthorityId:0};a.authority.authorityId=G.value.authorityId,a.authority.authorityName=G.value.authorityName,a.authority.parentId=G.value.parentId,a.authority.dataAuthorityId=$.value.dataAuthorityId,a.oldAuthorityId=$.value.authorityId;0===(await w(a)).code&&(n({type:"success",message:"复制成功！"}),X())}}ra(),P.value=!1}}))},ua=()=>{D.value=[{authorityId:0,authorityName:"根角色"}],da(M.value,D.value,!1)},da=(a,e,t)=>{G.value.authorityId=String(G.value.authorityId),a&&a.forEach((a=>{if(a.children&&a.children.length){const l={authorityId:a.authorityId,authorityName:a.authorityName,disabled:t||a.authorityId===G.value.authorityId,children:[]};da(a.children,l.children,t||a.authorityId===G.value.authorityId),e.push(l)}else{const l={authorityId:a.authorityId,authorityName:a.authorityName,disabled:t||a.authorityId===G.value.authorityId};e.push(l)}}))},sa=a=>{ra(),T.value="新增角色",F.value="add",G.value.parentId=a,ua(),P.value=!0};return(a,g)=>{const w=p,_=b,k=I,z=f,W=h,K=m,L=v,Q=y,ra=E,da=A,na=c;return e(),t("div",U,[l(x,{title:"注：右上角头像下拉可切换角色"}),r("div",B,[r("div",q,[l(w,{type:"primary",icon:"plus",onClick:g[0]||(g[0]=a=>sa(0))},{default:o((()=>[i("新增角色")])),_:1})]),l(k,{data:M.value,"tree-props":{children:"children",hasChildren:"hasChildren"},"row-key":"authorityId",style:{width:"100%"}},{default:o((()=>[l(_,{label:"角色ID","min-width":"180",prop:"authorityId"}),l(_,{align:"left",label:"角色名称","min-width":"180",prop:"authorityName"}),l(_,{align:"left",label:"操作",width:"460"},{default:o((a=>[l(w,{icon:"setting",type:"primary",link:"",onClick:e=>{return t=a.row,R.value=!0,void(O.value=t);var t}},{default:o((()=>[i("设置权限")])),_:2},1032,["onClick"]),l(w,{icon:"plus",type:"primary",link:"",onClick:e=>sa(a.row.authorityId)},{default:o((()=>[i("新增子角色")])),_:2},1032,["onClick"]),l(w,{icon:"copy-document",type:"primary",link:"",onClick:e=>(a=>{ua(),T.value="拷贝角色",F.value="copy";for(const e in G.value)G.value[e]=a[e];$.value=a,P.value=!0})(a.row)},{default:o((()=>[i("拷贝")])),_:2},1032,["onClick"]),l(w,{icon:"edit",type:"primary",link:"",onClick:e=>(a=>{ua(),T.value="编辑角色",F.value="edit";for(const e in G.value)G.value[e]=a[e];ua(),P.value=!0})(a.row)},{default:o((()=>[i("编辑")])),_:2},1032,["onClick"]),l(w,{icon:"delete",type:"primary",link:"",onClick:e=>{return t=a.row,void s.confirm("此操作将永久删除该角色, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await j({authorityId:t.authorityId})).code&&(n({type:"success",message:"删除成功!"}),1===M.value.length&&J.value>1&&J.value--,X())})).catch((()=>{n({type:"info",message:"已取消删除"})}));var t}},{default:o((()=>[i("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])]),l(Q,{modelValue:P.value,"onUpdate:modelValue":g[4]||(g[4]=a=>P.value=a),title:T.value},{footer:o((()=>[r("div",S,[l(w,{onClick:oa},{default:o((()=>[i("取 消")])),_:1}),l(w,{type:"primary",onClick:ia},{default:o((()=>[i("确 定")])),_:1})])])),default:o((()=>[l(L,{ref_key:"authorityForm",ref:la,model:G.value,rules:H.value,"label-width":"80px"},{default:o((()=>[l(W,{label:"父级角色",prop:"parentId"},{default:o((()=>[l(z,{modelValue:G.value.parentId,"onUpdate:modelValue":g[1]||(g[1]=a=>G.value.parentId=a),style:{width:"100%"},disabled:"add"===F.value,options:D.value,props:{checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},"show-all-levels":!1,filterable:""},null,8,["modelValue","disabled","options"])])),_:1}),l(W,{label:"角色ID",prop:"authorityId"},{default:o((()=>[l(K,{modelValue:G.value.authorityId,"onUpdate:modelValue":g[2]||(g[2]=a=>G.value.authorityId=a),disabled:"edit"===F.value,autocomplete:"off"},null,8,["modelValue","disabled"])])),_:1}),l(W,{label:"角色姓名",prop:"authorityName"},{default:o((()=>[l(K,{modelValue:G.value.authorityName,"onUpdate:modelValue":g[3]||(g[3]=a=>G.value.authorityName=a),autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),R.value?(e(),u(na,{key:0,modelValue:R.value,"onUpdate:modelValue":g[5]||(g[5]=a=>R.value=a),"custom-class":"auth-drawer","with-header":!1,size:"40%",title:"角色配置"},{default:o((()=>[l(da,{"before-leave":ta,type:"border-card"},{default:o((()=>[l(ra,{label:"角色菜单"},{default:o((()=>[l(C,{ref_key:"menus",ref:Z,row:O.value,onChangeRow:Y},null,8,["row"])])),_:1}),l(ra,{label:"角色api"},{default:o((()=>[l(N,{ref_key:"apis",ref:aa,row:O.value,onChangeRow:Y},null,8,["row"])])),_:1}),l(ra,{label:"资源权限"},{default:o((()=>[l(V,{ref_key:"datas",ref:ea,authority:M.value,row:O.value,onChangeRow:Y},null,8,["authority","row"])])),_:1})])),_:1})])),_:1},8,["modelValue"])):d("",!0)])}}});export{D as default};
