/*! 
 Build based on gin-vue-admin 
 Time : 1682164992000 */
import{s as e,r as a,F as t,o as s,c as o,d as r,e as c,w as i,h as d,j as l,b as n,E as p}from"./index.8a0793e1.js";import{E as u}from"./tree.f3bb8dcd.js";import"./checkbox.37c5511a.js";/* empty css               *//* empty css              */import{e as h}from"./api.ce9eb6db.js";import{_ as f}from"./_plugin-vue_export-helper.cdc0426e.js";import"./index.73f4d5b1.js";import"./isEqual.308df9cb.js";import"./_Uint8Array.84fc61e2.js";const m={class:"clearfix sticky-button"},b={class:"tree-content"},y={name:"Apis"},v=f(Object.assign(y,{props:{row:{default:function(){return{}},type:Object}},setup(f,{expose:y}){const v=f,j=a({children:"children",label:"description"}),k=a(""),x=a([]),I=a([]),g=a("");(async()=>{const a=(await h()).data.apis;x.value=E(a);const t=await(s={authorityId:v.row.authorityId},e({url:"/casbin/getPolicyPathByAuthorityId",method:"post",data:s}));var s;g.value=v.row.authorityId,I.value=[],t.data.paths&&t.data.paths.forEach((e=>{I.value.push("p:"+e.path+"m:"+e.method)}))})();const w=a(!1),_=()=>{w.value=!0},E=e=>{const a={};e&&e.forEach((e=>{e.onlyId="p:"+e.path+"m:"+e.method,Object.prototype.hasOwnProperty.call(a,e.apiGroup)?a[e.apiGroup].push(e):Object.assign(a,{[e.apiGroup]:[e]})}));const t=[];for(const s in a){const e={ID:s,description:s+"组",children:a[s]};t.push(e)}return t},O=a(null),C=async()=>{const a=O.value.getCheckedNodes(!0);var t=[];a&&a.forEach((e=>{var a={path:e.path,method:e.method};t.push(a)}));var s;0===(await(s={authorityId:g.value,casbinInfos:t},e({url:"/casbin/updateCasbin",method:"post",data:s}))).code&&l({type:"success",message:"api设置成功"})};y({needConfirm:w,enterAndNext:()=>{C()}});const A=(e,a)=>!e||-1!==a.description.indexOf(e);return t(k,(e=>{O.value.filter(e)})),(e,a)=>{const t=n,l=p,h=u;return s(),o("div",null,[r("div",m,[c(t,{modelValue:k.value,"onUpdate:modelValue":a[0]||(a[0]=e=>k.value=e),class:"fitler",placeholder:"筛选"},null,8,["modelValue"]),c(l,{class:"fl-right",type:"primary",onClick:C},{default:i((()=>[d("确 定")])),_:1})]),r("div",b,[c(h,{ref_key:"apiTree",ref:O,data:x.value,"default-checked-keys":I.value,props:j.value,"default-expand-all":"","highlight-current":"","node-key":"onlyId","show-checkbox":"","filter-node-method":A,onCheck:_},null,8,["data","default-checked-keys","props"])])])}}}),[["__scopeId","data-v-bf5ba3a0"]]);export{v as default};
