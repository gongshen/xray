/*! 
 Build based on gin-vue-admin 
 Time : 1682150634000 */
import{s as a,r as e,F as t,o as s,c as o,d as r,e as d,w as i,h as l,j as n,b as p,E as c}from"./index.6e37b4a9.js";import{E as u}from"./tree.af31befa.js";import"./checkbox.22c523d6.js";/* empty css               *//* empty css              */import{e as h}from"./api.d961304d.js";import{_ as m}from"./_plugin-vue_export-helper.cdc0426e.js";import"./index.d6d05ae6.js";import"./isEqual.9a8132d8.js";import"./_Uint8Array.74027f42.js";const f={class:"clearfix sticky-button"},y={class:"tree-content"},v={name:"Apis"},b=m(Object.assign(v,{props:{row:{default:function(){return{}},type:Object}},setup(m,{expose:v}){const b=m,j=e({children:"children",label:"description"}),k=e(""),x=e([]),I=e([]),g=e("");(async()=>{const e=(await h()).data.apis;x.value=E(e);const t=await(s={authorityId:b.row.authorityId},a({url:"/casbin/getPolicyPathByAuthorityId",method:"post",data:s}));var s;g.value=b.row.authorityId,I.value=[],t.data.paths&&t.data.paths.forEach((a=>{I.value.push("p:"+a.path+"m:"+a.method)}))})();const w=e(!1),_=()=>{w.value=!0},E=a=>{const e={};a&&a.forEach((a=>{a.onlyId="p:"+a.path+"m:"+a.method,Object.prototype.hasOwnProperty.call(e,a.apiGroup)?e[a.apiGroup].push(a):Object.assign(e,{[a.apiGroup]:[a]})}));const t=[];for(const s in e){const a={ID:s,description:s+"组",children:e[s]};t.push(a)}return t},O=e(null),C=async()=>{const e=O.value.getCheckedNodes(!0);var t=[];e&&e.forEach((a=>{var e={path:a.path,method:a.method};t.push(e)}));var s;0===(await(s={authorityId:g.value,casbinInfos:t},a({url:"/casbin/updateCasbin",method:"post",data:s}))).code&&n({type:"success",message:"api设置成功"})};v({needConfirm:w,enterAndNext:()=>{C()}});const A=(a,e)=>!a||-1!==e.description.indexOf(a);return t(k,(a=>{O.value.filter(a)})),(a,e)=>{const t=p,n=c,h=u;return s(),o("div",null,[r("div",f,[d(t,{modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=a=>k.value=a),class:"fitler",placeholder:"筛选"},null,8,["modelValue"]),d(n,{class:"fl-right",type:"primary",onClick:C},{default:i((()=>[l("确 定")])),_:1})]),r("div",y,[d(h,{ref_key:"apiTree",ref:O,data:x.value,"default-checked-keys":I.value,props:j.value,"default-expand-all":"","highlight-current":"","node-key":"onlyId","show-checkbox":"","filter-node-method":A,onCheck:_},null,8,["data","default-checked-keys","props"])])])}}}),[["__scopeId","data-v-bf5ba3a0"]]);export{b as default};
